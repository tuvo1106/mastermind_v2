# Mastermind v2

<p align="center">
  <img src="https://miro.medium.com/max/700/0*4xohKyVpcqZPmT9y.png">
</p>

# Mastermind

This repository contains a Mastermind API written in Express and Typescript. Users can play the game with an included command line application.

## Table of Contents

- [Dependencies](#dependencies)
  - [Node](#node)
  - [NPM or YARN](#npm-or-yarn)
  - [Git](#git)
  - [Installation](#installation)
- [How to Play](#how-to-play)
- [Data Persistence](#data-persistence)
- [Development](#development)
  - [API Docs](#api-docs)
  - [GraphQL Server](#graphql-server)
  - [Testing](#testing)
  - [Continuous Integration](#continuous-integration)
- [Authors](#authors)

## Dependencies

### Node

- Node 14.0 or above is recommended to run this application.
- [Download Node](https://nodejs.org/en/download/)

### NPM or Yarn

- This is required to install all the node packages.
- NPM comes with node
- Yarn can be installed with the following command: `npm install -g yarn`

### Git

- [Download Git](https://git-scm.com/downloads)

### Installation

- On your terminal, clone the repository with Git:

`git clone https://github.com/tuvo1106/mastermind_v2`

- To install dependencies, use::

`npm install`

- To start the Express application, use:

`npm run start`

- To play the game, use:

`npm run cli`

## How to Play

In Mastermind, the player (aka the Codebreaker) has to guess a random sequence of four numbers generated by the Codemaker, which can either be the computer or another player. The Codebreaker wins when they guess both the number and order correctly for all four numbers within a given amount of turns. The breakdown of the different difficulties is shown below:

| Difficulty | Number Range | Number of Turns |
| :--------: | :----------: | :-------------: |
|    Easy    |    0 - 7     |       12        |
|   Normal   |    0 - 7     |       10        |
|    Hard    |    0 - 7     |        8        |
| Dark Souls |    0 - 7     |        6        |

Each guess is made by typing in 4 consecutive numbers in the terminal.
After each guess, the Codebreaker will get feedback on the previous
guess. The feedback is represented in the following symbols:

```
X = Correct number, correct location
O = Correct number, incorrect location
* = Incorrect number, incorrect location
```

For example, if the correct sequence is [1, 9, 0, 2] and the player guesses
[1, 2, 3, 4], the feedback that is given will be:

`X O * *`

- The (1) `X` represents the 1 being the right number in the right position.
- The (1) `O` represents the 2 being the right number, but in the wrong positon.
- The (2) `*` represents 3 and 4 both being incorrect numbers and therefore, not
  belonging on the board.

In another example, if the correct sequence is [3, 3, 6, 9] and the player
guesses [1, 3, 6, 9], the feedback that is given will be:

`X X X *`

- The (3) `X` represents 3, 6 and 9 being the right numbers in the right
  positions.
- The (1) `*` represents the remaining unmatched number 3 being compared with
  the only unmatched guess which is 1, therefore resulting in a mismatch of
  number and position.

## Data Persistence

By default, the app stores all game data in memory. However, users can choose to store data with MongoDB by using Docker containers.

This requires an installation of a Docker client on your local operating system.

- [Download Docker](https://www.docker.com/products/docker-desktop)

- To start the MongoDB and Express app with Docker, use:

`npm run docker`

In the background, this runs `docker compose build && docker compose up` to start up the containers.

Express will be running on port `3000` and MongoDB will be running on port `27017`.

## Development

### API Docs

API docs can be found at `http://localhost:3000/api-docs` when the API is running.

![swagger](/src/assets/swagger.png)

### GraphQL Server

Users can also interact with the API using a GraphQL playground at `http://localhost:3000/graphql` when the API is running.

![graph-ql](/src/assets/graphql.png)

### Testing

To run tests, use:

`npm run test`

There are currently `53` total tests in this project with `95.27%` test coverage. (5/4/21)

```
-----------------------------------|---------|----------|---------|---------|-------------------
File                               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
-----------------------------------|---------|----------|---------|---------|-------------------
All files                          |   92.93 |    87.61 |      90 |   95.27 |
 src                               |   97.06 |      100 |   66.67 |     100 |
  app.ts                           |   97.06 |      100 |   66.67 |     100 |
 src/application/enums             |     100 |      100 |     100 |     100 |
  appStatus.ts                     |     100 |      100 |     100 |     100 |
  gameStatus.ts                    |     100 |      100 |     100 |     100 |
 src/application/errors            |     100 |       50 |     100 |     100 |
  bad-request-error.ts             |     100 |       50 |     100 |     100 | 7
  custom-error.interface.ts        |     100 |       50 |     100 |     100 | 5
  not-found-error.ts               |     100 |       50 |     100 |     100 | 7
 src/application/factories         |     100 |       50 |     100 |     100 |
  game-factory.ts                  |     100 |      100 |     100 |     100 |
  user-factory.ts                  |     100 |       50 |     100 |     100 | 33
 src/application/middlewares       |    87.5 |       50 |     100 |   85.71 |
  error-handler.ts                 |    87.5 |       50 |     100 |   85.71 | 17
 src/application/utils             |     100 |       50 |     100 |     100 |
  createDirIfNotExists.ts          |     100 |       50 |     100 |     100 | 4
 src/domain/game                   |   97.58 |    91.49 |   96.88 |   97.22 |
  game-controller.ts               |     100 |      100 |     100 |     100 |
  game-params-validator-service.ts |      95 |    91.67 |     100 |      95 | 15
  game-service.ts                  |     100 |      100 |     100 |     100 |
  number-generator-service.ts      |   93.18 |       75 |    87.5 |    92.5 | 39-41
 src/domain/health-check           |     100 |      100 |     100 |     100 |
  health-check-controller.ts       |     100 |      100 |     100 |     100 |
  health-check-service.ts          |     100 |      100 |     100 |     100 |
 src/domain/user                   |     100 |      100 |     100 |     100 |
  user-controller.ts               |     100 |      100 |     100 |     100 |
  user-params-validator-service.ts |     100 |      100 |     100 |     100 |
  user-service.ts                  |     100 |      100 |     100 |     100 |
 src/infra/api-docs                |     100 |      100 |     100 |     100 |
  swagger-config.ts                |     100 |      100 |     100 |     100 |
 src/infra/graphql                 |   36.36 |        0 |       0 |   51.28 |
  Mutation.ts                      |    12.5 |      100 |       0 |   22.22 | 13-58
  Query.ts                         |   41.67 |        0 |       0 |      50 | 9-27
  apollo-server-config.ts          |     100 |      100 |     100 |     100 |
 src/infra/logger                  |     100 |      100 |     100 |     100 |
  winston-config-stream.ts         |     100 |      100 |     100 |     100 |
 src/infra/repository              |     100 |    92.31 |     100 |     100 |
  in-memory-repository.ts          |     100 |    92.31 |     100 |     100 | 26,77
  respository.interface.ts         |     100 |      100 |     100 |     100 |
-----------------------------------|---------|----------|---------|---------|-------------------

Test Suites: 7 passed, 7 total
Tests:       1 skipped, 53 passed, 54 total
Snapshots:   0 total
Time:        3.557 s, estimated 13 s
Ran all test suites.
```

### Continuous Integration

This repository uses a CircleUI workflow that runs all tests on every commit. Contributors can see the results of the test before their merge their PR.

![circle_ci_pic](/src/assets/circle_ci.png)

## Authors

Created by:

- [Tu Vo](https://github.com/tuvo1106)
- Email: tuvo1106@gmail.com
